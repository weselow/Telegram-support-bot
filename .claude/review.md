# PR Review Instructions

## Язык и формат

Отвечай на русском языке. Будь конкретным и лаконичным.

## Контекст проекта

Telegram-бот техподдержки:
- TypeScript, Node.js 22, grammY, Fastify, Prisma
- PostgreSQL, Redis (BullMQ очереди)
- Docker + Caddy (reverse proxy)
- Стандарты в `docs/standards/`

## Приоритеты проверки (по важности)

### 1. Критические (блокируют merge)
- **Безопасность**: SQL injection, XSS, утечка secrets, небезопасные зависимости
- **Потеря данных**: отсутствие транзакций где нужно, race conditions
- **Сломанная функциональность**: код не делает то, что заявлено

### 2. Важные
- **Silent failures**: ошибки которые глотаются без логирования
- **Тесты**: новый код без тестов, сломанные тесты
- **Обработка ошибок**: отсутствие try/catch где нужно, неинформативные сообщения

### 3. Желательные
- **Соответствие стандартам**: `docs/standards/`, код-стайл
- **Производительность**: очевидные проблемы (N+1, отсутствие индексов)
- **Читаемость**: сложный код без комментариев

## Что НЕ проверять

- Форматирование (есть ESLint/Prettier)
- Стилистические предпочтения без влияния на качество
- "А можно было бы ещё добавить..." — фичи вне скоупа PR

## Формат ответа

### Структура review

```
## Краткое резюме
[1-2 предложения: что делает PR, общая оценка]

## Критические замечания
[Если есть — блокируют merge]

## Рекомендации к внедрению
[Обоснованные улучшения, которые стоит сделать сейчас]

## В технический долг
[Хорошие идеи, но можно отложить. Указать почему]

## Отклонить
[Over-engineering, избыточное, нецелесообразное. Указать почему]

## Вердикт
[APPROVE / REQUEST_CHANGES / COMMENT]
```

### Критерии категоризации

**Внедрить сейчас** если:
- Исправляет баг или уязвимость
- Занимает <15 минут
- Без этого код хуже работает

**В технический долг** если:
- Улучшение есть, но не критично
- Требует значительных изменений
- Можно жить без этого

**Отклонить** если:
- Преждевременная оптимизация
- Абстракция ради абстракции
- "Best practice" без реальной пользы для проекта
- Усложняет код без явной выгоды

## Примеры

### Внедрить сейчас
> Добавить `try/catch` в `getLocationByIp` — ошибка API сейчас крашит весь запрос.

### В технический долг
> Вынести маппинг ошибок в отдельный сервис. Улучшит тестируемость, но текущий код работает. Создать TD-XXX.

### Отклонить
> "Добавить generic error handler" — текущая обработка достаточна для 3 эндпоинтов. Абстракция преждевременна.
