# Решения по задаче 007: Mirror topic → user

## 1. Фильтрация сообщений бота

**Решение:** Проверка `ctx.from.is_bot` в начале обработчика.

**Причина:** Простая и надёжная проверка. Бот не должен отвечать на свои же сообщения, чтобы избежать бесконечных циклов.

## 2. Определение "системных" сообщений

**Решение:** Игнорируем сообщения без `message_thread_id` (General topic).

**Причина:** Сообщения в General топике не относятся к конкретным тикетам и не должны пересылаться пользователям.

## 3. Обработка ошибок доставки

**Решение:** Логирование ошибок без уведомления пользователя.

**Причина:**
- Пользователь не должен получать технические ошибки о проблемах с зеркалированием
- Ошибки логируются для анализа командой поддержки
- Сотрудник поддержки увидит ошибку в логах и может повторить отправку

## 4. Архитектура сендеров

**Решение:** Переиспользование паттерна из task 006 — массив sender-функций.

**Причина:**
- Единообразная архитектура для обоих направлений
- Низкая цикломатическая сложность
- Лёгкое добавление новых типов сообщений

## 5. Фильтрация в bot.ts vs middleware

**Решение:** Фильтрация через `bot.on('message').filter()` вместо отдельного middleware.

**Причина:**
- Проще и понятнее
- grammY рекомендует использовать `.filter()` для таких случаев
- Middleware нужен для более сложной логики (авторизация, throttling)
