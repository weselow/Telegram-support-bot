# Задача 006: Зеркалирование сообщений (user → topic)

**Этап:** 2 - Основной функционал
**Статус:** DONE
**Приоритет:** Высокий

## Описание

Пересылать сообщения пользователя из DM в топик поддержки.

## Подзадачи

- [x] Сервис зеркалирования (src/services/message.service.ts):
  - [x] Копирование текстовых сообщений
  - [x] Копирование медиа (фото, видео, документы, аудио, voice)
  - [x] Копирование контактов и геолокации
  - [x] Копирование стикеров и GIF
  - [x] Сохранение связи message_id в messages_map
- [x] Обработчик сообщений пользователя (src/bot/handlers/message.ts):
  - [x] Получение топика из БД
  - [x] Вызов сервиса зеркалирования
  - [x] Обработка ошибок
- [x] Репозиторий сообщений (src/db/repositories/message.repository.ts)

## Зависимости

- [005-topic-creation](../005-topic-creation/task.md) ✓

## Результат

- ✓ Все типы сообщений пересылаются в топик
- ✓ Связь dm_message_id ↔ topic_message_id сохраняется
- ✓ Медиа отображаются корректно

## Реализация

### Поддерживаемые типы сообщений

- text, photo, video, document, voice, audio
- video_note, sticker, animation (GIF)
- contact, location

### Архитектура

- Handler map pattern для низкой cyclomatic complexity
- Каждый тип сообщения обрабатывается отдельной функцией
- Логирование неподдерживаемых типов
- Уведомление пользователя при ошибке доставки
