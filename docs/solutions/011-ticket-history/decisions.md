# Решения по задаче 011: История событий тикета

## Анализ текущего состояния

### Уже реализовано:
- `OPENED` — записывается при создании тикета (ticket.service.ts)
- `CLOSED` — записывается при закрытии (callback.ts, status.service.ts)
- `STATUS_CHANGED` — записывается при смене статуса (callback.ts, status.service.ts)

### Требуется реализовать:
- `REOPENED` — при сообщении в закрытый тикет
- `PHONE_UPDATED` — при изменении телефона (не реализовано в системе)

## Решения

### 1. Переоткрытие тикета

**Сценарий:** Пользователь с закрытым тикетом отправляет сообщение.

**Поведение:**
1. Статус меняется CLOSED → NEW
2. Записывается событие REOPENED (с question = текст нового сообщения)
3. Пользователю отправляется запрос подтверждения телефона
4. Сообщение зеркалится в топик
5. В топик отправляется уведомление о переоткрытии

### 2. Запрос подтверждения телефона

**Логика:**
- При переоткрытии отправляем сообщение с inline-кнопкой "Подтвердить телефон"
- Если телефона нет — кнопка "Добавить телефон" (contact request)

### 3. Событие PHONE_UPDATED

**Когда записывать:**
- Пока нет механизма изменения телефона
- Отложить до реализации функционала телефона

## Файлы для изменения

1. `src/bot/handlers/message.ts` — добавить логику переоткрытия
2. `src/services/status.service.ts` — добавить триггер REOPEN
3. Возможно новый хендлер для callback подтверждения телефона
