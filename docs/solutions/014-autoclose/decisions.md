# Решения по задаче 014: Автозакрытие через 7 дней

## Архитектура

### Таймеры автозакрытия
- **Запуск**: при смене статуса на WAITING_CLIENT
- **Отмена**: при ответе клиента (CLIENT_REPLY)
- **Срабатывание**: через 7 дней без ответа

### Job ID формат
`autoclose-{userId}-{topicId}` — уникальный ID для отмены.

## Уведомления

### Клиенту (при закрытии)
```
Ваше обращение было автоматически закрыто из-за отсутствия ответа в течение 7 дней.

Если вопрос всё ещё актуален, просто напишите нам — мы откроем обращение заново.
```

### В топик (internal)
```
// ⏰ Тикет автоматически закрыт (7 дней без ответа клиента)
```

## Логика

1. Сотрудник меняет статус на "Ждём клиента" → запускается таймер 7 дней
2. Если клиент отвечает → таймер отменяется
3. Если 7 дней прошло → тикет закрывается, клиент уведомляется
4. Если клиент напишет после закрытия → тикет переоткроется (уже реализовано)

## Напоминание через 24 часа

Решено НЕ делать — избыточно:
- SLA-таймеры уже напоминают о неотвеченных тикетах
- 7 дней достаточно длинный срок

## Реализация

### autoclose.service.ts
- `startAutocloseTimer(userId, topicId)` — запускает таймер 7 дней
- `cancelAutocloseTimer(userId, topicId)` — отменяет таймер

### autoclose.worker.ts
- Проверяет что статус всё ещё WAITING_CLIENT
- Меняет статус на CLOSED
- Уведомляет клиента
- Отправляет internal-сообщение в топик
- Записывает событие в историю

## Интеграция

- При смене статуса на WAITING_CLIENT (вручную через кнопку) → startAutocloseTimer
- При CLIENT_REPLY → cancelAutocloseTimer
