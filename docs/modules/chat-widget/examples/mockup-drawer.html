<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DellShop Chat Widget - Drawer вариант</title>
  <style>
    /* Reset */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(to bottom, #f8fafc, #ffffff);
      min-height: 100vh;
    }

    /* Demo page content */
    .demo-content {
      max-width: 800px;
      margin: 0 auto;
      padding: 40px 20px;
    }

    .demo-content h1 {
      color: #0f172a;
      margin-bottom: 16px;
    }

    .demo-content p {
      color: #64748b;
      line-height: 1.6;
      margin-bottom: 12px;
    }

    /* ========================================
       CHAT WIDGET - DRAWER VARIANT
       ======================================== */

    :root {
      --chat-brand: #1e3a8a;
      --chat-brand-hover: #1e40af;
      --chat-bg: #ffffff;
      --chat-surface: #f8fafc;
      --chat-text: #0f172a;
      --chat-text-muted: #64748b;
      --chat-border: #e2e8f0;
      --chat-radius-sm: 12px;
      --chat-radius-md: 16px;
      --chat-transition: 300ms ease-in-out;
    }

    /* Container */
    .dellshop-chat {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 999999;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }

    /* ===== CHAT BUTTON ===== */
    .chat-button {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: var(--chat-brand);
      border: none;
      cursor: pointer;
      box-shadow: 0 4px 16px rgba(30, 58, 138, 0.35);
      transition: transform var(--chat-transition), box-shadow var(--chat-transition);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    .chat-button:hover {
      transform: scale(1.05);
      box-shadow: 0 6px 20px rgba(30, 58, 138, 0.45);
    }

    .chat-button svg {
      width: 28px;
      height: 28px;
      fill: white;
    }

    .chat-button .badge {
      position: absolute;
      top: -4px;
      right: -4px;
      background: #ef4444;
      color: white;
      font-size: 12px;
      font-weight: 600;
      min-width: 20px;
      height: 20px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0 6px;
    }

    /* ===== BACKDROP ===== */
    .chat-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(4px);
      -webkit-backdrop-filter: blur(4px);
      opacity: 0;
      pointer-events: none;
      transition: opacity var(--chat-transition);
      z-index: 999998;
    }

    .chat-backdrop.open {
      opacity: 1;
      pointer-events: auto;
    }

    /* ===== DRAWER ===== */
    .chat-drawer {
      position: fixed;
      top: 0;
      right: 0;
      bottom: 0;
      width: 420px;
      max-width: 100vw;
      background: var(--chat-bg);
      box-shadow: -8px 0 32px rgba(0, 0, 0, 0.15);
      display: flex;
      flex-direction: column;
      transform: translateX(100%);
      transition: transform var(--chat-transition);
      z-index: 999999;
    }

    .chat-drawer.open {
      transform: translateX(0);
    }

    /* Header */
    .chat-header {
      background: var(--chat-brand);
      color: white;
      padding: 16px 20px;
      display: flex;
      align-items: center;
      gap: 12px;
      flex-shrink: 0;
    }

    .chat-header .avatar {
      width: 44px;
      height: 44px;
      background: rgba(255,255,255,0.2);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .chat-header .avatar svg {
      width: 26px;
      height: 26px;
      fill: white;
    }

    .chat-header .info {
      flex: 1;
    }

    .chat-header .title {
      font-weight: 600;
      font-size: 17px;
    }

    .chat-header .status {
      font-size: 13px;
      opacity: 0.85;
      display: flex;
      align-items: center;
      gap: 6px;
      margin-top: 2px;
    }

    .chat-header .status-dot {
      width: 8px;
      height: 8px;
      background: #22c55e;
      border-radius: 50%;
    }

    .chat-header .status-dot.offline {
      background: #f59e0b;
    }

    .chat-header .close-btn {
      width: 40px;
      height: 40px;
      background: rgba(255,255,255,0.15);
      border: none;
      border-radius: 12px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background var(--chat-transition);
    }

    .chat-header .close-btn:hover {
      background: rgba(255,255,255,0.25);
    }

    .chat-header .close-btn svg {
      width: 20px;
      height: 20px;
      fill: white;
    }

    /* Connection status banner */
    .connection-status {
      padding: 10px 20px;
      background: #fef3c7;
      color: #92400e;
      font-size: 13px;
      text-align: center;
      display: none;
      flex-shrink: 0;
    }

    .connection-status.disconnected {
      display: block;
    }

    /* Telegram banner */
    .telegram-banner {
      padding: 12px 20px;
      background: linear-gradient(135deg, #0088cc 0%, #00a0dc 100%);
      color: white;
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 14px;
      cursor: pointer;
      transition: opacity var(--chat-transition);
      flex-shrink: 0;
    }

    .telegram-banner:hover {
      opacity: 0.9;
    }

    .telegram-banner svg {
      width: 22px;
      height: 22px;
      fill: white;
      flex-shrink: 0;
    }

    .telegram-banner span {
      flex: 1;
    }

    .telegram-banner .arrow {
      opacity: 0.7;
      font-size: 18px;
    }

    /* Messages */
    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
      background: var(--chat-surface);
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .message {
      max-width: 85%;
      padding: 12px 16px;
      border-radius: var(--chat-radius-sm);
      font-size: 14px;
      line-height: 1.5;
      animation: messageSlide 0.3s ease-out;
    }

    @keyframes messageSlide {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .message.user {
      background: var(--chat-brand);
      color: white;
      margin-left: auto;
      border-bottom-right-radius: 4px;
    }

    .message.support {
      background: white;
      color: var(--chat-text);
      border-bottom-left-radius: 4px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.06);
    }

    .message .time {
      font-size: 11px;
      opacity: 0.7;
      margin-top: 6px;
      display: block;
    }

    .message.support .time {
      color: var(--chat-text-muted);
    }

    /* Typing indicator */
    .typing-indicator {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 12px 16px;
      background: white;
      border-radius: var(--chat-radius-sm);
      max-width: 100px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.06);
    }

    .typing-indicator .dots {
      display: flex;
      gap: 4px;
    }

    .typing-indicator .dot {
      width: 6px;
      height: 6px;
      background: var(--chat-text-muted);
      border-radius: 50%;
      animation: typingBounce 1.4s infinite ease-in-out;
    }

    .typing-indicator .dot:nth-child(1) { animation-delay: 0s; }
    .typing-indicator .dot:nth-child(2) { animation-delay: 0.2s; }
    .typing-indicator .dot:nth-child(3) { animation-delay: 0.4s; }

    @keyframes typingBounce {
      0%, 60%, 100% { transform: translateY(0); }
      30% { transform: translateY(-4px); }
    }

    /* Input area */
    .chat-input-area {
      padding: 16px 20px;
      background: white;
      border-top: 1px solid var(--chat-border);
      display: flex;
      gap: 12px;
      align-items: flex-end;
      flex-shrink: 0;
    }

    .chat-input {
      flex: 1;
      border: 1px solid var(--chat-border);
      border-radius: var(--chat-radius-sm);
      padding: 12px 16px;
      font-size: 14px;
      resize: none;
      outline: none;
      transition: border-color var(--chat-transition);
      font-family: inherit;
      max-height: 120px;
      line-height: 1.4;
    }

    .chat-input:focus {
      border-color: var(--chat-brand);
    }

    .chat-input::placeholder {
      color: var(--chat-text-muted);
    }

    .send-btn {
      width: 48px;
      height: 48px;
      background: var(--chat-brand);
      border: none;
      border-radius: var(--chat-radius-sm);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background var(--chat-transition);
      flex-shrink: 0;
    }

    .send-btn:hover {
      background: var(--chat-brand-hover);
    }

    .send-btn:disabled {
      background: var(--chat-border);
      cursor: not-allowed;
    }

    .send-btn svg {
      width: 22px;
      height: 22px;
      fill: white;
    }

    /* ===== OFFLINE FORM ===== */
    .offline-form {
      padding: 28px 24px;
      display: flex;
      flex-direction: column;
      gap: 18px;
      flex: 1;
      overflow-y: auto;
    }

    .offline-form h3 {
      color: var(--chat-text);
      font-size: 20px;
      font-weight: 600;
    }

    .offline-form p {
      color: var(--chat-text-muted);
      font-size: 14px;
      line-height: 1.5;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .form-group label {
      font-size: 13px;
      font-weight: 500;
      color: var(--chat-text);
    }

    .form-group input,
    .form-group textarea {
      border: 1px solid var(--chat-border);
      border-radius: var(--chat-radius-sm);
      padding: 12px 16px;
      font-size: 14px;
      outline: none;
      transition: border-color var(--chat-transition);
      font-family: inherit;
    }

    .form-group input:focus,
    .form-group textarea:focus {
      border-color: var(--chat-brand);
    }

    .form-group textarea {
      resize: none;
      min-height: 100px;
    }

    .submit-btn {
      background: var(--chat-brand);
      color: white;
      border: none;
      border-radius: var(--chat-radius-sm);
      padding: 14px 24px;
      font-size: 15px;
      font-weight: 500;
      cursor: pointer;
      transition: background var(--chat-transition);
    }

    .submit-btn:hover {
      background: var(--chat-brand-hover);
    }

    /* ===== MOBILE RESPONSIVE ===== */
    @media (max-width: 480px) {
      .chat-drawer {
        width: 100vw;
      }

      .dellshop-chat {
        bottom: 16px;
        right: 16px;
      }

      .chat-button {
        width: 56px;
        height: 56px;
      }
    }

    /* ===== DEMO CONTROLS ===== */
    .demo-controls {
      position: fixed;
      top: 20px;
      left: 20px;
      background: white;
      padding: 16px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      gap: 8px;
      z-index: 1000;
    }

    .demo-controls h3 {
      font-size: 14px;
      color: #0f172a;
      margin-bottom: 4px;
    }

    .demo-controls button {
      padding: 8px 12px;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      background: white;
      cursor: pointer;
      font-size: 13px;
      transition: all 0.2s;
      text-align: left;
    }

    .demo-controls button:hover {
      background: #f8fafc;
      border-color: #cbd5e1;
    }

    .demo-controls button.active {
      background: #1e3a8a;
      color: white;
      border-color: #1e3a8a;
    }

    .demo-controls .divider {
      height: 1px;
      background: #e2e8f0;
      margin: 4px 0;
    }

    .demo-controls .label {
      font-size: 11px;
      color: #64748b;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
  </style>
</head>
<body>
  <!-- Demo page content -->
  <div class="demo-content">
    <h1>DellShop - Серверное оборудование</h1>
    <p>
      Это демонстрационная страница для просмотра виджета чата в варианте Drawer
      (боковая панель на всю высоту). Виджет выдвигается справа с затемнением фона.
    </p>
    <p>
      Этот вариант лучше подходит для длинных диалогов и показывает больше сообщений
      одновременно. Похож на CartDrawer корзины на сайте.
    </p>
  </div>

  <!-- Demo controls -->
  <div class="demo-controls">
    <h3>Drawer вариант</h3>
    <span class="label">Состояния:</span>
    <button onclick="showState('closed')" id="btn-closed" class="active">Закрыт</button>
    <button onclick="showState('open')" id="btn-open">Открыт (online)</button>
    <button onclick="showState('typing')" id="btn-typing">Печатает...</button>
    <button onclick="showState('offline')" id="btn-offline">Офлайн форма</button>
    <button onclick="showState('disconnected')" id="btn-disconnected">Нет связи</button>
    <button onclick="showState('unread')" id="btn-unread">Непрочитанные</button>
  </div>

  <!-- Backdrop -->
  <div class="chat-backdrop" id="chat-backdrop"></div>

  <!-- Chat Button -->
  <div class="dellshop-chat">
    <button class="chat-button" id="chat-toggle">
      <svg viewBox="0 0 24 24">
        <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H5.17L4 17.17V4h16v12z"/>
        <path d="M7 9h10v2H7zm0-3h10v2H7z"/>
      </svg>
      <span class="badge" id="unread-badge" style="display: none;">2</span>
    </button>
  </div>

  <!-- Chat Drawer -->
  <div class="chat-drawer" id="chat-drawer">
    <!-- Header -->
    <div class="chat-header">
      <div class="avatar">
        <svg viewBox="0 0 24 24">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/>
        </svg>
      </div>
      <div class="info">
        <div class="title">Поддержка DellShop</div>
        <div class="status">
          <span class="status-dot" id="status-dot"></span>
          <span id="status-text">Онлайн</span>
        </div>
      </div>
      <button class="close-btn" id="close-btn">
        <svg viewBox="0 0 24 24">
          <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
        </svg>
      </button>
    </div>

    <!-- Connection status -->
    <div class="connection-status" id="connection-status">
      Соединение потеряно. Переподключение...
    </div>

    <!-- Telegram banner -->
    <div class="telegram-banner" id="telegram-banner" style="display: none;">
      <svg viewBox="0 0 24 24">
        <path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm5.562 8.161c-.18 1.897-.962 6.502-1.359 8.627-.168.9-.5 1.201-.82 1.23-.697.064-1.226-.461-1.901-.903-1.056-.692-1.653-1.123-2.678-1.799-1.185-.781-.417-1.21.258-1.911.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.139-5.062 3.345-.479.329-.913.489-1.302.481-.428-.009-1.252-.242-1.865-.44-.751-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.831-2.529 6.998-3.015 3.333-1.386 4.025-1.627 4.477-1.635.099-.002.321.023.465.141.121.099.154.232.17.325.015.094.034.31.019.478z"/>
      </svg>
      <span>Продолжить в Telegram</span>
      <span class="arrow">→</span>
    </div>

    <!-- Messages -->
    <div class="chat-messages" id="chat-messages"></div>

    <!-- Offline form -->
    <div class="offline-form" id="offline-form" style="display: none;">
      <h3>Мы сейчас офлайн</h3>
      <p>Оставьте сообщение, и мы ответим на email в ближайшее время.</p>

      <div class="form-group">
        <label>Email *</label>
        <input type="email" placeholder="your@email.com">
      </div>

      <div class="form-group">
        <label>Телефон (опционально)</label>
        <input type="tel" placeholder="+7 (___) ___-__-__">
      </div>

      <div class="form-group">
        <label>Сообщение *</label>
        <textarea placeholder="Опишите ваш вопрос..."></textarea>
      </div>

      <button class="submit-btn">Отправить</button>
    </div>

    <!-- Input -->
    <div class="chat-input-area" id="chat-input-area">
      <textarea class="chat-input" placeholder="Напишите сообщение..." rows="1"></textarea>
      <button class="send-btn">
        <svg viewBox="0 0 24 24">
          <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
        </svg>
      </button>
    </div>
  </div>

  <script>
    // Demo messages (longer conversation for drawer)
    const demoMessages = [
      { from: 'support', text: 'Добрый день! Чем могу помочь?', time: '18:05' },
      { from: 'user', text: 'Здравствуйте! Интересует сервер Dell PowerEdge R740', time: '18:06' },
      { from: 'support', text: 'Отличный выбор! R740 - универсальный 2U сервер. Какая конфигурация вас интересует?', time: '18:06' },
      { from: 'user', text: 'Нужно 2 процессора Xeon Gold, 256GB RAM, RAID-контроллер', time: '18:07' },
      { from: 'support', text: 'Понял. Рекомендую конфигурацию:\n\n• 2x Intel Xeon Gold 6248R (24 ядра, 3.0 GHz)\n• 8x 32GB DDR4-2933 ECC RDIMM\n• PERC H740P RAID Controller\n• 8x 2.5" SAS/SATA Hot-Swap отсеки', time: '18:08' },
      { from: 'user', text: 'Какая цена?', time: '18:09' },
      { from: 'support', text: 'Данная конфигурация: 1 250 000 ₽ с НДС. Доставка по Москве бесплатно. Гарантия 3 года.', time: '18:09' },
    ]

    const typingIndicator = `
      <div class="typing-indicator" id="typing">
        <div class="dots">
          <span class="dot"></span>
          <span class="dot"></span>
          <span class="dot"></span>
        </div>
      </div>
    `

    let currentState = 'closed'

    function showState(state) {
      currentState = state

      // Update buttons
      document.querySelectorAll('.demo-controls button').forEach(btn => {
        btn.classList.remove('active')
      })
      document.getElementById('btn-' + state).classList.add('active')

      const drawer = document.getElementById('chat-drawer')
      const backdrop = document.getElementById('chat-backdrop')
      const messagesContainer = document.getElementById('chat-messages')
      const offlineForm = document.getElementById('offline-form')
      const inputArea = document.getElementById('chat-input-area')
      const connectionStatus = document.getElementById('connection-status')
      const statusDot = document.getElementById('status-dot')
      const statusText = document.getElementById('status-text')
      const unreadBadge = document.getElementById('unread-badge')
      const telegramBanner = document.getElementById('telegram-banner')

      // Reset
      drawer.classList.remove('open')
      backdrop.classList.remove('open')
      connectionStatus.classList.remove('disconnected')
      offlineForm.style.display = 'none'
      inputArea.style.display = 'flex'
      messagesContainer.style.display = 'flex'
      unreadBadge.style.display = 'none'
      telegramBanner.style.display = 'none'
      statusDot.classList.remove('offline')
      statusText.textContent = 'Онлайн'

      switch (state) {
        case 'closed':
          break

        case 'open':
          drawer.classList.add('open')
          backdrop.classList.add('open')
          telegramBanner.style.display = 'flex'
          renderMessages(demoMessages)
          break

        case 'typing':
          drawer.classList.add('open')
          backdrop.classList.add('open')
          telegramBanner.style.display = 'flex'
          renderMessages(demoMessages, true)
          break

        case 'offline':
          drawer.classList.add('open')
          backdrop.classList.add('open')
          statusDot.classList.add('offline')
          statusText.textContent = 'Офлайн'
          offlineForm.style.display = 'flex'
          inputArea.style.display = 'none'
          messagesContainer.style.display = 'none'
          break

        case 'disconnected':
          drawer.classList.add('open')
          backdrop.classList.add('open')
          connectionStatus.classList.add('disconnected')
          telegramBanner.style.display = 'flex'
          renderMessages(demoMessages)
          break

        case 'unread':
          unreadBadge.style.display = 'flex'
          break
      }
    }

    function renderMessages(messages, showTyping = false) {
      const container = document.getElementById('chat-messages')
      container.innerHTML = messages.map(msg => `
        <div class="message ${msg.from}">
          ${msg.text.replace(/\n/g, '<br>')}
          <span class="time">${msg.time}</span>
        </div>
      `).join('')

      if (showTyping) {
        container.innerHTML += typingIndicator
      }

      container.scrollTop = container.scrollHeight
    }

    // Event listeners
    document.getElementById('chat-toggle').addEventListener('click', () => {
      if (currentState === 'closed' || currentState === 'unread') {
        showState('open')
      }
    })

    document.getElementById('close-btn').addEventListener('click', () => {
      showState('closed')
    })

    document.getElementById('chat-backdrop').addEventListener('click', () => {
      showState('closed')
    })

    // Initialize
    showState('closed')
  </script>
</body>
</html>
