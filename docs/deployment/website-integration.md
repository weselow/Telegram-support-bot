# ะะฝัะตะณัะฐัะธั ั ัะฐะนัะพะผ

## ะะฑะทะพั

ะะพะปัะทะพะฒะฐัะตะปั ะบะปะธะบะฐะตั ะบะฝะพะฟะบั "ะะพะดะดะตัะถะบะฐ" ะฝะฐ ัะฐะนัะต โ ะฟะตัะตัะพะดะธั ัะตัะตะท redirect ัะตัะฒะธั โ ะพัะบััะฒะฐะตััั Telegram ั ะฑะพัะพะผ โ ะฑะพั ะทะฝะฐะตั ะพัะบัะดะฐ ะฟัะธััะป ะฟะพะปัะทะพะฒะฐัะตะปั ะธ ะตะณะพ ะณะตะพะปะพะบะฐัะธั.

## ะััะธัะตะบัััะฐ

```
โโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโโ
โ    ะกะฐะนั     โ โโโบ โ  /ask-support endpoint       โ โโโบ โ   Telegram   โ
โ   (ะบะปะธะบ)    โ     โ  (HTTP ัะตัะฒะตั ะฒ ะฑะพัะต)        โ     โ              โ
โโโโโโโโโโโโโโโ     โ                              โ     โโโโโโโโฌโโโโโโโโ
                    โ  1. ะัะพะฒะตัะบะฐ User-Agent      โ            โ
                    โ  2. ะะพะปััะตะฝะธะต IP + Referer   โ            โ
                    โ  3. GeoIP โ ะณะพัะพะด (DaData)   โ            โ
                    โ  4. ะกะพััะฐะฝะตะฝะธะต ะฒ Redis       โ            โ
                    โ  5. Redirect ะฒ Telegram      โ            โ
                    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ            โ
                                                                โผ
                                                   โโโโโโโโโโโโโโโโโโโโโโโโโโ
                                                   โ  ะะพั                   โ
                                                   โ  - ะะพะปััะฐะตั SHORT_ID   โ
                                                   โ  - ะะพััะฐัั ะธะท Redis    โ
                                                   โ  - ะกะพะทะดะฐัั ัะธะบะตั       โ
                                                   โโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ะะฝัะตะณัะฐัะธั ะฝะฐ ัะฐะนัะต

### ะะดะฝะฐ ัััะปะบะฐ ะดะปั ะฒัะตั ัะฐะนัะพะฒ

```html
<a href="https://support.yoursite.com/ask-support" class="support-button">
  ๐ฌ ะัะถะฝะฐ ะฟะพะผะพัั?
</a>
```

Referer ะฟะตัะตะดะฐัััั ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฑัะฐัะทะตัะพะผ.

### ะะฐะถะฝะพ

- ะกััะปะบะฐ ะดะพะปะถะฝะฐ ะฑััั ะพะฑััะฝะพะน `<a>`, ะฝะต ัะตัะตะท JavaScript
- ะะต ะดะพะฑะฐะฒะปััั `rel="noreferrer"` โ ะธะฝะฐัะต Referer ะฝะต ะฟะตัะตะดะฐัััั
- HTTPS โ HTTPS ัะฐะฑะพัะฐะตั ะบะพััะตะบัะฝะพ

---

## ะงัะพ ัะพะฑะธัะฐะตััั

| ะะฐะฝะฝัะต | ะััะพัะฝะธะบ | ะะพะบะฐะทัะฒะฐะตััั |
|--------|----------|--------------|
| URL ัััะฐะฝะธัั | Referer header | ะะณะตะฝัะฐะผ ะฒ ัะธะบะตัะต |
| IP ะฐะดัะตั | X-Forwarded-For | ะะณะตะฝัะฐะผ ะฒ ัะธะบะตัะต |
| ะะพัะพะด | DaData API ะฟะพ IP | ะะณะตะฝัะฐะผ ะฒ ัะธะบะตัะต |

**ะะพะปัะทะพะฒะฐัะตะปั IP ะฝะต ะฟะพะบะฐะทัะฒะฐะตััั.**

---

## ะะฐััะพัะบะฐ ัะธะบะตัะฐ (ะดะปั ะฐะณะตะฝัะพะฒ)

```
๐ค ะะฒะฐะฝ ะะตััะพะฒ (@ivanpetrov)
๐ฑ +7 999 123-45-67
๐ ะััะพัะฝะธะบ: https://shop.com/product/iphone-15
๐ IP: 95.67.xx.xx (ะกะฐัะฐัะพะฒ)
๐ ะกัะฐััั: ะะพะฒัะน
```

---

## ะะฐัะธัะฐ ะพั ะฑะพัะพะฒ

Endpoint `/ask-support` ะฟัะพะฒะตััะตั User-Agent ะธ ะฑะปะพะบะธััะตั:

- ะัััะพะน User-Agent
- ะะพะธัะบะพะฒัะต ะฑะพัั: Googlebot, Bingbot, YandexBot, Baidu
- CLI: curl, wget, python-requests, Go-http-client
- Headless ะฑัะฐัะทะตัั: HeadlessChrome, PhantomJS

ะัะธ ะฑะปะพะบะธัะพะฒะบะต ะฒะพะทะฒัะฐัะฐะตััั 403 Forbidden.

ะะพะฟะพะปะฝะธัะตะปัะฝะพ: rate limit 10 ะทะฐะฟัะพัะพะฒ ะฒ ะผะธะฝััั ั ะพะดะฝะพะณะพ IP.

---

## ะะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั

```env
# ะะพะผะตะฝ ะดะปั redirect ัะตัะฒะธัะฐ
SUPPORT_DOMAIN=support.yoursite.com

# Username ะฑะพัะฐ (ะฑะตะท @)
BOT_USERNAME=your_support_bot

# DaData API ะบะปัั ะดะปั GeoIP
DADATA_API_KEY=your-api-key
```

---

## ะะฝััะฐััััะบัััะฐ

### Docker Compose

```yaml
services:
  bot:
    # ... ัััะตััะฒัััะธะต ะฝะฐัััะพะนะบะธ
    ports:
      - "3000:3000"  # HTTP ัะตัะฒะตั ะดะปั /ask-support

  caddy:
    image: caddy:2-alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./Caddyfile:/etc/caddy/Caddyfile
      - caddy_data:/data
    depends_on:
      - bot

volumes:
  caddy_data:
```

### Caddyfile

```
support.yoursite.com {
    reverse_proxy bot:3000
}
```

Caddy ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฟะพะปััะธั SSL ัะตััะธัะธะบะฐั ะพั Let's Encrypt.

---

## ะกัะตะผะฐ ะดะฐะฝะฝัั ะฒ Redis

```
# Redirect ะดะฐะฝะฝัะต (TTL 1 ัะฐั)
redirect:{shortId} โ {
  url: "https://shop.com/product/123",
  ip: "95.67.12.34",
  city: "ะกะฐัะฐัะพะฒ"
}

# GeoIP ะบะตั (TTL 7 ะดะฝะตะน)
geoip:{ip} โ {
  city: "ะกะฐัะฐัะพะฒ"
}
```

---

## ะกัะฐััั ัะตะฐะปะธะทะฐัะธะธ

| ะะพะผะฟะพะฝะตะฝั | ะกัะฐััั |
|-----------|--------|
| ะััะธัะตะบัััะฐ | โ ะกะฟัะพะตะบัะธัะพะฒะฐะฝะฐ |
| HTTP endpoint /ask-support | โณ TODO (ะทะฐะดะฐัะฐ 019) |
| ะคะธะปััั ะฑะพัะพะฒ | โณ TODO |
| GeoIP ัะตัะตะท DaData | โณ TODO |
| ะะตัะธัะพะฒะฐะฝะธะต GeoIP | โณ TODO |
| ะะฑัะฐะฑะพัะบะฐ ะฒ startHandler | โณ TODO |
| ะะฐััะพัะบะฐ ัะธะบะตัะฐ ั IP/ะณะพัะพะดะพะผ | โณ TODO |
| Docker + Caddy | โณ TODO |

---

## ะคะปะพั ะฟะพะปัะทะพะฒะฐัะตะปั

```
1. ะะปะธะบ ะฟะพ ะบะฝะพะฟะบะต ะฝะฐ ัะฐะนัะต
   โ
2. Redirect ัะตัะตะท /ask-support
   โ
3. ะัะบััะฒะฐะตััั Telegram โ ะฑะพั ั ?start=SHORT_ID
   โ
4. ะะพั: "ะะดัะฐะฒััะฒัะนัะต! ะะฟะธัะธัะต ะฒะฐัั ะฟัะพะฑะปะตะผั"
   โ
5. ะะพะปัะทะพะฒะฐัะตะปั ะฟะธัะตั ัะพะพะฑัะตะฝะธะต
   โ
6. ะกะพะทะดะฐัััั ัะธะบะตั ั ะดะฐะฝะฝัะผะธ:
   - URL ะธััะพัะฝะธะบะฐ
   - IP + ะณะพัะพะด (ะฒะธะดะฝั ัะพะปัะบะพ ะฐะณะตะฝัะฐะผ)
```
