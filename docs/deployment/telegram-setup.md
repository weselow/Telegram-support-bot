# Настройка Telegram для бота поддержки

## Обзор

Для работы бота нужно:
1. Создать бота в Telegram
2. Создать супергруппу с топиками для команды поддержки
3. Добавить бота в группу с правами администратора

---

## 1. Создание бота

### Шаг 1: Открыть @BotFather

Найдите в Telegram бота [@BotFather](https://t.me/BotFather) и начните диалог.

### Шаг 2: Создать нового бота

```
/newbot
```

BotFather спросит:
1. **Имя бота** — отображаемое имя (например: `Поддержка MyCompany`)
2. **Username бота** — уникальный идентификатор, должен заканчиваться на `bot` (например: `mycompany_support_bot`)

### Шаг 3: Сохранить токен

После создания BotFather выдаст токен вида:
```
7123456789:AAHxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

Сохраните его в переменную окружения:
```env
BOT_TOKEN=7123456789:AAHxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

### Шаг 4: Настроить бота (опционально)

```
/mybots → выбрать бота → Bot Settings
```

Рекомендуемые настройки:
- **Inline Mode** — OFF (не используется)
- **Group Privacy** — OFF (бот видит все сообщения в группе)

---

## 2. Создание супергруппы поддержки

### Шаг 1: Создать группу

1. В Telegram: **Меню → Новая группа**
2. Назовите группу (например: `Поддержка клиентов`)
3. Добавьте хотя бы одного участника (можно потом удалить)

### Шаг 2: Преобразовать в супергруппу

Группа автоматически станет супергруппой при включении истории:

1. **Настройки группы → История чата**
2. Выберите **Видна** (Visible)

### Шаг 3: Включить топики

1. **Настройки группы → Темы (Topics)**
2. Включите переключатель

После этого в группе появится раздел "Основной" (General).

### Шаг 4: Получить ID группы

**Способ 1: Через @userinfobot**

1. Добавьте [@userinfobot](https://t.me/userinfobot) в группу
2. Бот напишет ID группы (начинается с `-100`)
3. Удалите бота из группы

**Способ 2: Через веб-версию**

1. Откройте [web.telegram.org](https://web.telegram.org)
2. Перейдите в группу
3. ID будет в URL: `https://web.telegram.org/k/#-1234567890`
4. Добавьте `-100` после минуса: `-100` + `1234567890` = `-1001234567890`

**Пример:**
```
URL:  https://web.telegram.org/k/#-1234567890
                                   ↓
ID:   -100 + 1234567890 = -1001234567890
```

Сохраните ID:
```env
SUPPORT_GROUP_ID=-1001234567890
```

---

## 3. Добавление бота в группу

### Шаг 1: Добавить бота

1. **Настройки группы → Добавить участников**
2. Найдите бота по username
3. Добавьте его в группу

### Шаг 2: Назначить администратором

1. **Настройки группы → Администраторы → Добавить администратора**
2. Выберите бота
3. Выдайте права:

| Право | Требуется |
|-------|-----------|
| Изменение профиля группы | ❌ |
| Удаление сообщений | ✅ |
| Блокировка участников | ❌ |
| Приглашение по ссылке | ❌ |
| Закрепление сообщений | ✅ |
| Управление топиками | ✅ |
| Управление видеочатами | ❌ |
| Анонимность | ❌ |
| Добавление администраторов | ❌ |

**Обязательные права:**
- Удаление сообщений — для модерации
- Закрепление сообщений — для карточки тикета
- Управление топиками — для создания/закрытия топиков

---

## 4. Итоговая конфигурация

### .env файл

```env
# Telegram
BOT_TOKEN=7123456789:AAHxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
SUPPORT_GROUP_ID=-1001234567890

# Database
DATABASE_URL=postgresql://user:password@localhost:5432/support_bot

# Redis
REDIS_URL=redis://localhost:6379

# Optional
SENTRY_DSN=
NODE_ENV=production
LOG_LEVEL=info
```

### Проверка

Запустите бота и отправьте `/start` в личные сообщения боту. Если всё настроено правильно:
1. Бот ответит приветственным сообщением
2. В супергруппе создастся новый топик с вашим именем

---

## Troubleshooting

### Бот не отвечает

1. Проверьте `BOT_TOKEN` — токен должен быть без пробелов
2. Убедитесь что бот запущен (`npm start`)
3. Проверьте логи на ошибки

### Топик не создаётся

1. Проверьте `SUPPORT_GROUP_ID` — должен начинаться с `-100`
2. Убедитесь что бот — администратор группы
3. Проверьте что у бота есть право "Управление топиками"
4. Убедитесь что в группе включены топики

### Ошибка "Chat not found"

- ID группы неверный
- Бот не добавлен в группу
- Группа была удалена или бот исключён

### Ошибка "Not enough rights"

- Бот не администратор
- У бота недостаточно прав (см. таблицу выше)

---

## Безопасность

- Никогда не публикуйте `BOT_TOKEN` в открытых репозиториях
- Используйте `.env` файл (добавлен в `.gitignore`)
- Для production используйте секреты (Docker secrets, Vault, etc.)
