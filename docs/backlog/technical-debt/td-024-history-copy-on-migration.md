# TD-024: Копирование истории при миграции в Telegram

**Статус:** TODO
**Приоритет:** Низкий
**Источник:** Задача 021-web-chat-api

## Описание

При привязке Telegram аккаунта к веб-сессии (`/start link_<token>`) копировать историю сообщений из веб-чата в топик Telegram.

## Текущее поведение

- После привязки синхронизируются только новые сообщения
- Старые сообщения из веб-чата не видны в топике

## Ожидаемое поведение

1. При успешной привязке получить историю сообщений пользователя
2. Отправить их в топик с пометкой "[ИСТОРИЯ]" или аналогичной
3. Ограничить количество копируемых сообщений (например, последние 50)

## Реализация

```typescript
// В processLinkToken после привязки:
const history = await messageRepository.getHistory(user.id, { limit: 50 });
for (const msg of history.reverse()) {
  await bot.api.sendMessage(SUPPORT_GROUP_ID, `[ИСТОРИЯ] ${msg.text}`, {
    message_thread_id: user.topicId,
  });
}
```

## Риски

- Telegram rate limits при большом количестве сообщений
- Дублирование если история уже была скопирована

## Критерии готовности

- [ ] История копируется при первой привязке
- [ ] Не копируется повторно
- [ ] Соблюдаются rate limits Telegram
