# 019: Onboarding Flow —Å Deep Link

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í—ã—Å–æ–∫–∏–π
**–°—Ç–∞—Ç—É—Å:** TODO

## –û–ø–∏—Å–∞–Ω–∏–µ

–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π onboarding –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –ø—Ä–∏—Ö–æ–¥—è—â–∏—Ö —Å —Å–∞–π—Ç–∞ —á–µ—Ä–µ–∑ deep link.

## –¢–µ–∫—É—â–µ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ ‚Üí —Å—Ä–∞–∑—É —Å–æ–∑–¥–∞—ë—Ç—Å—è —Ç–∏–∫–µ—Ç.

## –¶–µ–ª–µ–≤–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

```
1. –ö–ª–∏–∫ –ø–æ —Å—Å—ã–ª–∫–µ t.me/bot?start=PAYLOAD
   ‚Üì
2. –ë–æ—Ç –ø–∞—Ä—Å–∏—Ç payload, –∏–∑–≤–ª–µ–∫–∞–µ—Ç sourceUrl
   ‚Üì
3. –ë–æ—Ç: "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –í–∏–∂—É, –≤—ã –ø—Ä–∏—à–ª–∏ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: {url}"
        "–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –Ω–æ–º–µ—Ä–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–ª—è —Å–≤—è–∑–∏"
        [üì± –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç]  [–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å]
   ‚Üì
4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–Ω—Ç–∞–∫—Ç / –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç
   ‚Üì
5. –ë–æ—Ç: "–û–ø–∏—à–∏—Ç–µ –≤–∞—à—É –ø—Ä–æ–±–ª–µ–º—É"
   ‚Üì
6. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç ‚Üí —Å–æ–∑–¥–∞—ë—Ç—Å—è —Ç–∏–∫–µ—Ç —Å sourceUrl
```

## –ó–∞–¥–∞—á–∏

- [ ] –î–æ–±–∞–≤–∏—Ç—å `SUPPORT_LINK_SECRET` –≤ env.ts —Å—Ö–µ–º—É
- [ ] –°–æ–∑–¥–∞—Ç—å `src/utils/payload.ts` ‚Äî encode/decode/validate payload
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `start.ts` ‚Äî –ø–∞—Ä—Å–∏—Ç—å payload, –Ω–∞—á–∞—Ç—å onboarding
- [ ] –°–æ–∑–¥–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ onboarding (–∂–¥—ë–º —Ç–µ–ª–µ—Ñ–æ–Ω / –∂–¥—ë–º –æ–ø–∏—Å–∞–Ω–∏–µ)
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `message.ts` ‚Äî —É—á–∏—Ç—ã–≤–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ onboarding
- [ ] –°–æ—Ö—Ä–∞–Ω—è—Ç—å `sourceUrl` –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–∏–∫–µ—Ç–∞
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É "–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å" –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞
- [ ] –¢–µ—Å—Ç—ã

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### Payload —Ñ–æ—Ä–º–∞—Ç
```
base64url(url).timestamp.hmac_signature
```

### –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–í–∞—Ä–∏–∞–Ω—Ç—ã —Ö—Ä–∞–Ω–µ–Ω–∏—è:
1. Redis (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è) ‚Äî TTL –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞
2. –ù–æ–≤–æ–µ –ø–æ–ª–µ –≤ User –º–æ–¥–µ–ª–∏

```typescript
type OnboardingState =
  | { step: 'awaiting_phone', sourceUrl?: string }
  | { step: 'awaiting_question', sourceUrl?: string, phone?: string }
  | null;
```

## –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `src/bot/handlers/start.ts`
- `src/bot/handlers/message.ts`
- `src/bot/handlers/phone.ts`
- `src/config/env.ts`
- `docs/deployment/website-integration.md`
