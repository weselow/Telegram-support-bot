# 026: ะกััะฐะฝะธัะฐ ะธััะพัะธะธ ัะฐัะฐ ะดะปั ะบะปะธะตะฝัะฐ

**ะกัะฐััั:** TODO
**ะัะธะพัะธัะตั:** ะกัะตะดะฝะธะน
**ะัะตะฝะบะฐ:** 4-6 ัะฐัะพะฒ
**ะััะพัะฝะธะบ:** ะะตัะตัะฐะฑะพัะบะฐ TD-024

## ะะฟะธัะฐะฝะธะต

ะะปะธะตะฝั ะผะพะถะตั ะพัะบัััั ัััะปะบั ะธ ะฟะพัะผะพััะตัั ะธััะพัะธั ัะฒะพะตะน ะฟะตัะตะฟะธัะบะธ ั ะฟะพะดะดะตัะถะบะพะน. ะกััะปะบะฐ ัะพะดะตัะถะธั ะฟะพะดะฟะธัะฐะฝะฝัะน ัะพะบะตะฝ, ะณะตะฝะตัะธััะตััั ะฟะพ ะทะฐะฟัะพัั.

## ะกัะตะฝะฐัะธะน ะธัะฟะพะปัะทะพะฒะฐะฝะธั

1. ะะปะธะตะฝั ะฟัะธะฒัะทัะฒะฐะตั Telegram ะบ ะฒะตะฑ-ัะตััะธะธ
2. ะ ัะพะฟะธะบะต/ะบะฐััะพัะบะต ะฟะพัะฒะปัะตััั ัััะปะบะฐ "ะะพัะผะพััะตัั ะธััะพัะธั ัะฐัะฐ"
3. ะะปะธะตะฝั ะฟะตัะตัะพะดะธั ะฟะพ ัััะปะบะต โ ะฒะธะดะธั ัะฒะพั ะฟะตัะตะฟะธัะบั

## API

### ะะตะฝะตัะฐัะธั ัััะปะบะธ

```
POST /api/chat/history-link
Authorization: session cookie

Response:
{
  "url": "https://chat.dellshop.ru/history?token=<signed_token>",
  "expiresAt": "2025-12-31T12:00:00Z"
}
```

### ะัะพัะผะพัั ะธััะพัะธะธ

```
GET /history?token=<signed_token>

Token payload (HMAC-SHA256):
{
  "oderId": "uuid",
  "ticketId": "uuid",
  "exp": 1735646400  // Unix timestamp, TTL 24h
}

Response: HTML ัััะฐะฝะธัะฐ ั ะธััะพัะธะตะน ัะฐัะฐ
```

## ะขัะตะฑะพะฒะฐะฝะธั

### ะคัะฝะบัะธะพะฝะฐะปัะฝัะต
- [ ] ะญะฝะดะฟะพะธะฝั ะณะตะฝะตัะฐัะธะธ ัะพะบะตะฝะฐ
- [ ] ะกััะฐะฝะธัะฐ ะฟัะพัะผะพััะฐ ะธััะพัะธะธ
- [ ] ะัะพะฑัะฐะถะตะฝะธะต ัะพะพะฑัะตะฝะธะน (ัะตะบัั, ะฒัะตะผั, ะพัะฟัะฐะฒะธัะตะปั)
- [ ] ะัะพะฑัะฐะถะตะฝะธะต ะผะตะดะธะฐ (ะธะทะพะฑัะฐะถะตะฝะธั, ะดะพะบัะผะตะฝัั)
- [ ] ะะดะฐะฟัะธะฒะฝัะน ะดะธะทะฐะนะฝ (mobile-friendly)

### ะะตะทะพะฟะฐัะฝะพััั
- [ ] ะขะพะบะตะฝ ะฟะพะดะฟะธัะฐะฝ HMAC-SHA256
- [ ] TTL ัะพะบะตะฝะฐ โ 24 ัะฐัะฐ
- [ ] ะะฐะปะธะดะฐัะธั ะฟะพะดะฟะธัะธ ะฝะฐ ัะตัะฒะตัะต
- [ ] ะขะพะปัะบะพ ััะตะฝะธะต (ะฝะตะปัะทั ะพัะฟัะฐะฒะปััั ัะพะพะฑัะตะฝะธั)

### UI (ัะตัะธัั ะฟะพะทะถะต)
- [ ] ะะฐัะธะฐะฝั A: Server-side HTML + Tailwind CSS
- [ ] ะะฐัะธะฐะฝั B: React + shadcn components

## ะกัััะบัััะฐ ัััะฐะฝะธัั

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ะััะพัะธั ัะฐัะฐ #12345            โ
โ  ะขะธะบะตั ะพั 30.12.2025            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                 โ
โ  [ะั] 10:30                     โ
โ  ะะดัะฐะฒััะฒัะนัะต, ั ะผะตะฝั ะฟัะพะฑะปะตะผะฐ  โ
โ                                 โ
โ            [ะะพะดะดะตัะถะบะฐ] 10:35    โ
โ            ะะพะฑััะน ะดะตะฝั! ะะฟะธัะธัะต โ
โ            ะฟะพะดัะพะฑะฝะตะต            โ
โ                                 โ
โ  [ะั] 10:40                     โ
โ  ะะพั ัะบัะธะฝัะพั ะพัะธะฑะบะธ            โ
โ  [๐ท screenshot.png]            โ
โ                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  ะกััะปะบะฐ ะดะตะนััะฒะธัะตะปัะฝะฐ ะดะพ        โ
โ  31.12.2025 12:00               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ะคะฐะนะปั ะดะปั ัะพะทะดะฐะฝะธั

- `src/http/routes/history.ts` โ ัะพััั ะดะปั ะณะตะฝะตัะฐัะธะธ ะธ ะฟัะพัะผะพััะฐ
- `src/services/history-token.service.ts` โ ัะฐะฑะพัะฐ ั ัะพะบะตะฝะฐะผะธ
- `src/templates/history.html` ะธะปะธ React-ะบะพะผะฟะพะฝะตะฝั โ UI

## ะกะฒัะทะฐะฝะฝัะต ะทะฐะดะฐัะธ

- TD-024 (ะทะฐะผะตะฝะตะฝะฐ ััะพะน ะทะฐะดะฐัะตะน)
- [021](../solutions/021-web-chat-api/021-web-chat-api.md) โ Web Chat API
