# 020: Onboarding Flow –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Å–∞–π—Ç–∞

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** MEDIUM
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** 019-website-integration

## –¶–µ–ª—å

–£–ª—É—á—à–∏—Ç—å –ø–µ—Ä–≤—ã–π –∫–æ–Ω—Ç–∞–∫—Ç —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º, –ø—Ä–∏—à–µ–¥—à–∏–º —Å —Å–∞–π—Ç–∞ ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç, —Å–æ–±—Ä–∞—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω, –Ω–∞–ø—Ä–∞–≤–∏—Ç—å –¥–∏–∞–ª–æ–≥.

## –¢–µ–∫—É—â–µ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ ‚Üí —Å—Ä–∞–∑—É —Å–æ–∑–¥–∞—ë—Ç—Å—è —Ç–∏–∫–µ—Ç.

## –¶–µ–ª–µ–≤–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏—Ö–æ–¥–∏—Ç —Å —Å–∞–π—Ç–∞ (/start —Å payload)
   ‚Üì
2. –ë–æ—Ç: "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –í–∏–∂—É, –≤—ã –ø—Ä–∏—à–ª–∏ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: {url}"
        "–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –Ω–æ–º–µ—Ä–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–ª—è —Å–≤—è–∑–∏"
        [üì± –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç]  [–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å]
   ‚Üì
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–Ω—Ç–∞–∫—Ç / –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç
   ‚Üì
4. –ë–æ—Ç: "–û–ø–∏—à–∏—Ç–µ –≤–∞—à—É –ø—Ä–æ–±–ª–µ–º—É"
   ‚Üì
5. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç ‚Üí —Å–æ–∑–¥–∞—ë—Ç—Å—è —Ç–∏–∫–µ—Ç
```

## –ó–∞–¥–∞—á–∏

### –°–æ—Å—Ç–æ—è–Ω–∏–µ onboarding

- [ ] –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≥–¥–µ —Ö—Ä–∞–Ω–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ (Redis vs –ë–î)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ:
  ```typescript
  type OnboardingState =
    | { step: 'awaiting_phone', sourceUrl?: string, ip?: string, city?: string }
    | { step: 'awaiting_question', sourceUrl?: string, phone?: string }
    | null;
  ```
- [ ] TTL –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, 1 —á–∞—Å)

### –û–±—Ä–∞–±–æ—Ç–∫–∞ /start —Å payload

- [ ] –ï—Å–ª–∏ payload –µ—Å—Ç—å ‚Üí –Ω–∞—á–∞—Ç—å onboarding
- [ ] –ï—Å–ª–∏ payload –Ω–µ—Ç ‚Üí —Ç–µ–∫—É—â–µ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ (—Å—Ä–∞–∑—É –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ)

### –ó–∞–ø—Ä–æ—Å —Ç–µ–ª–µ—Ñ–æ–Ω–∞

- [ ] –°–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º (–æ—Ç–∫—É–¥–∞ –ø—Ä–∏—à—ë–ª)
- [ ] Inline –∫–Ω–æ–ø–∫–∏: "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç" / "–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å"
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ contact message
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ callback "–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å"

### –û–∂–∏–¥–∞–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–∞

- [ ] –ü–æ—Å–ª–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞/–ø—Ä–æ–ø—É—Å–∫–∞ ‚Äî –ø—Ä–æ—Å–∏–º –æ–ø–∏—Å–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—É
- [ ] –°–ª–µ–¥—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Üí —Å–æ–∑–¥–∞—ë—Ç —Ç–∏–∫–µ—Ç
- [ ] –°–±—Ä–æ—Å–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ onboarding

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å message handler

- [ ] –ü—Ä–æ–≤–µ—Ä—è—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ onboarding –ø–µ—Ä–µ–¥ –æ–±—ã—á–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
- [ ] –ï—Å–ª–∏ –≤ onboarding ‚Üí –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∫–∞–∫ —á–∞—Å—Ç—å flow

## –í–æ–ø—Ä–æ—Å—ã –¥–ª—è –ø—Ä–æ–¥—É–º—ã–≤–∞–Ω–∏—è

1. –ß—Ç–æ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∑–∞–≤–µ—Ä—à–∏–ª onboarding –∏ —É—à—ë–ª? (TTL)
2. –ß—Ç–æ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –µ—Å—Ç—å –≤ –±–∞–∑–µ –∏ –ø—Ä–∏—Ö–æ–¥–∏—Ç —Å–Ω–æ–≤–∞ —Å —Å–∞–π—Ç–∞?
3. –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ª–∏ URL –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∏–ª–∏ —Ç–æ–ª—å–∫–æ –∞–≥–µ–Ω—Ç–∞–º?
4. –ù—É–∂–µ–Ω –ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–π flow –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –æ–±—Ä–∞—â–µ–Ω–∏–π?

## –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `src/bot/handlers/start.ts`
- `src/bot/handlers/message.ts`
- `src/bot/handlers/phone.ts`
- `src/services/onboarding.service.ts` (–Ω–æ–≤—ã–π)

---

## –ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–∞–±–æ—Ç—ã

–û–∑–Ω–∞–∫–æ–º—å—Å—è —Å–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–º: [backlog-workflow-standard.md](../../standards/backlog-workflow-standard.md)
