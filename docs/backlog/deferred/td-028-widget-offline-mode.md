# TD-028: Chat Widget — Offline режим

**Приоритет:** High
**Статус:** Отложено (требует согласования с бэкендом)
**Модуль:** chat-widget
**Источник:** Перенесено из chat-widget/docs/backlog/TD-001

## Описание

Реализовать полную логику офлайн-режима когда операторы недоступны.

## Требования

### От бэкенда

WebSocket событие `operators_status`:
```json
{
  "type": "operators_status",
  "data": {
    "available": false,
    "nextAvailable": "2025-12-30T09:00:00Z",
    "reason": "outside_working_hours"
  }
}
```

### Фронтенд

- [ ] Обработка события `operators_status` в WebSocket клиенте
- [ ] Новый UI компонент: офлайн-форма обратной связи
- [ ] Переключение между чатом и формой
- [ ] Отправка сообщения через HTTP POST (не WebSocket)
- [ ] Подтверждение отправки пользователю
- [ ] Сохранение email/телефона для обратной связи

## Альтернативные варианты (fallback)

Если бэкенд не готов:
1. Рабочие часы в конфиге виджета (hardcoded)
2. Таймаут ответа (5 мин без ответа → показать форму)
3. Ошибка соединения WebSocket

## UI Макет

```
┌─────────────────────────────────────┐
│ [Logo] Поддержка DellShop      [✕]  │
├─────────────────────────────────────┤
│                                     │
│  😴 Операторы сейчас offline        │
│                                     │
│  Оставьте сообщение, и мы          │
│  ответим в рабочее время:          │
│  Пн-Пт 9:00-18:00 (МСК)            │
│                                     │
│  ┌─────────────────────────────┐   │
│  │ Ваш email или телефон       │   │
│  └─────────────────────────────┘   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │ Ваше сообщение...           │   │
│  │                             │   │
│  │                             │   │
│  └─────────────────────────────┘   │
│                                     │
│  [      Отправить сообщение     ]   │
│                                     │
└─────────────────────────────────────┘
```

## Связанные файлы

- `chat-widget/src/types/messages.ts` - добавить типы
- `chat-widget/src/transport/websocket.ts` - обработка события
- `chat-widget/src/ui/offline-form.ts` - новый компонент (создать)
- `chat-widget/src/widget.ts` - логика переключения
