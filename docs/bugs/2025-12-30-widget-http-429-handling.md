# Chat Widget: Обработка HTTP 429 (Rate Limit)

**Дата:** 2025-12-30
**Источник:** TD-031

## Проблема

При получении HTTP 429 от сервера виджет показывал общую ошибку "Unknown error" вместо понятного сообщения.

## Решение

Добавлена специальная обработка HTTP 429:

1. **RateLimitError** — новый класс ошибки в `http.ts`
2. **Обработка в rawRequest** — перехват 429 до общей обработки ошибок
3. **Обработка в widget.ts** — показ понятного сообщения "Восстанавливаем соединение..."

### Точки обработки в widget.ts:
- `connect()` — инициализация сессии
- `loadMoreHistory()` — загрузка истории
- `linkTelegram()` — получение ссылки Telegram

## Изменённые файлы

- `chat-widget/src/transport/http.ts` — добавлен RateLimitError, обработка 429
- `chat-widget/src/widget.ts` — импорт RateLimitError, обработка в catch-блоках

## Важно для разработчика

- `RateLimitError.retryAfterSeconds` хранит значение Retry-After (по умолчанию 60 сек)
- Свойство пока не используется, но доступно для будущей логики auto-retry
- При 429 виджет переходит в состояние `error` (как и при других ошибках)
