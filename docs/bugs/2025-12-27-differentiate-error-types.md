# Дифференциация типов ошибок в catch блоке

**Дата:** 2025-12-27
**Источник:** TD-002

## Проблема

Catch блок в `privateMessageHandler` ловил все ошибки без различия между типами. Пользователь получал одинаковое сообщение "попробуйте ещё раз" независимо от причины:
- Rate limiting (429) — retry имеет смысл, но нужно подождать
- Бот удалён из группы (403) — retry бессмысленен
- Прочие ошибки — стандартное сообщение

## Причина

Изначально использовался универсальный catch без анализа типа ошибки.

## Решение

Добавлена проверка `instanceof GrammyError` с дифференциацией по `error_code`:
- **429** → сообщение "Слишком много сообщений. Подождите."
- **403** → сообщение "Технические проблемы."
- **Остальное** → стандартное сообщение о повторной попытке

## Изменённые файлы

- `src/bot/handlers/message.ts` — добавлен импорт GrammyError, расширен catch блок
- `src/config/messages.ts` — добавлены поля `rateLimitError`, `technicalError` в схему
- `config/messages.json` — добавлены новые сообщения
- `src/bot/handlers/__tests__/message-errors.test.ts` — тесты для проверки типов ошибок

## Важно для разработчика

- GrammyError содержит `error_code` для кодов Telegram API
- Паттерн аналогичен `isBotBlockedError` в `support.ts`
- При добавлении новых типов ошибок — добавлять сообщения в messages.json и схему
