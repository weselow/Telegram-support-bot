# Unit-тесты для support handler

**Дата:** 2025-12-27
**Источник:** TD-005

## Проблема

`supportMessageHandler` и связанные функции не имели unit-тестов, что нарушало TDD стандарт и не давало регрессионной защиты.

## Решение

Добавлены 14 unit-тестов для `supportMessageHandler`:

### Фильтрация сообщений (7 тестов)
- Игнорирование сообщений от ботов
- Игнорирование без `from` / `message`
- Игнорирование General topic (без `thread_id`)
- Игнорирование внутренних сообщений (`//`, `#internal`)
- Игнорирование внутренних caption

### Поиск пользователя (2 теста)
- Поиск по topic_id
- Не зеркалить если пользователь не найден

### Зеркалирование (3 теста)
- Отправка в DM пользователя
- Отмена SLA таймеров
- Автосмена статуса

### Обработка ошибок (2 теста)
- Уведомление при блокировке бота
- Уведомление при ошибке доставки

## Изменённые файлы

- `src/bot/handlers/__tests__/support.test.ts` — новый файл с 14 тестами

## Важно для разработчика

- Тесты покрывают критичную логику фильтрации внутренних сообщений
- При изменении `supportMessageHandler` — запускать тесты
